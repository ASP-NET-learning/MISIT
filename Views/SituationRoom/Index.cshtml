<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
@{
    Layout = "_SituationRoomLayout.cshtml";
}


@using System.Text.Json;
@model IEnumerable<CookiesSalesSystem.Models.Machine>
@{
    var jsonAiMachineLabel = System.Text.Json.JsonSerializer.Serialize<object>(ViewBag.AiMachineLabel);
    var jsonMachinesValue = System.Text.Json.JsonSerializer.Serialize<object>(Model);
}

@{
    ViewBag.Title = "號機器統計";
}

<!--第一行第 一列-->
<div class="machine-group" id="machineGroup"></div>

<script>

    function getRandomNumberWithSign() {
        // Generate a random number between -10 and 10
        return (Math.random() * 20 - 10).toFixed(1);
    }

    function getStyledPercentage(number) {
        // Apply styling based on the sign of the number
        if (number < 0) {
            return `<span style="color: red; font-weight: bold;">${number}%</span>`;
        } else {
            return `<span style="color: green; font-weight: bold;">+${number}%</span>`;
        }
    }

    function createMachineElement(machineNumber) {
        var randomPercentage = getRandomNumberWithSign();
        var styledPercentage = getStyledPercentage(randomPercentage);

        var machineElement = document.createElement('div');
        machineElement.classList.add('col');

        machineElement.innerHTML = `
                    <div class="item"><i class="fa-solid fa-laptop"></i></div>
                    <div class="item">號機器${machineNumber}</div>
                    <div class="item-end">${styledPercentage}</div>
                `;

        return machineElement;
    }

    function createRowElement(startNumber, endNumber) {
        var rowElement = document.createElement('div');
        rowElement.classList.add('rows');

        for (var i = startNumber; i <= endNumber; i++) {
            var machineElement = createMachineElement(i);
            rowElement.appendChild(machineElement);
        }

        return rowElement;
    }

    function createSpaceElement() {
        var spaceElement = document.createElement('div');
        spaceElement.classList.add('space');
        return spaceElement;
    }

    var machineGroup = document.getElementById('machineGroup');

    machineGroup.appendChild(createRowElement(1, 3));
    machineGroup.appendChild(createSpaceElement());

    machineGroup.appendChild(createRowElement(4, 6));
    machineGroup.appendChild(createSpaceElement());

    machineGroup.appendChild(createRowElement(7, 9));
    machineGroup.appendChild(createSpaceElement());

    machineGroup.appendChild(createRowElement(10, 12));


</script>

<div class="machine-navbar">
    <div onclick="changeStyle(0)">自選</div>
    <div onclick="changeStyle(1)">所有號機器</div>
    <div onclick="changeStyle(2)">號機器稼動率</div>
    <div onclick="changeStyle(3)">目前維修號機器</div>
    <div onclick="changeStyle(4)">號機器設定</div>
    <div onclick="changeStyle(5)">機器排程</div>
</div>

<script>
    var currentActiveIndex = null;

    function changeStyle(index) {
        // 移除前一個 active 元素的樣式
        if (currentActiveIndex !== null) {
            document.querySelector('.machine-navbar div:nth-child(' + (currentActiveIndex + 1) + ')').classList.remove('active');
        }

        // 添加新 active 元素的樣式
        document.querySelector('.machine-navbar div:nth-child(' + (index + 1) + ')').classList.add('active');

        // 更新當前 active 元素的索引
        currentActiveIndex = index;
    }
</script>

<div class="machine-banner">
    <h3>公告</h3>
    <p>號機器整體運作狀況穩定。感謝各位同仁辛勤付出，確保順暢運轉。如有異常情況，請即時通報。期盼持續保持優良表現。</p>
</div>

<div machine-chart-group>
    <div class="machine-table">
        <p>機器溫度 單位:°C</p>
        <table>
            @foreach (var machine in Model)
            {
                <tr>
                    <td rowspan="4">@machine.AiMachine</td>
                    <td>機器1</td>
                    <td>@Math.Round(machine.MachineValue[0], 2)</td>
                </tr>
                <tr>
                    <td>機器2</td>
                    <td>@Math.Round(machine.MachineValue[1], 2)</td>
                </tr>
                <tr>
                    <td>機器3</td>
                    <td>@Math.Round(machine.MachineValue[2], 2)</td>
                </tr>
                <tr>
                    <td>機器4</td>
                    <td>@Math.Round(machine.MachineValue[3], 2)</td>
                </tr>
            }
        </table>
    </div>
    <div>
       @*  @Html.Partial("LineMachineValueData", Model) *@
    </div>
</div>




@RenderSection("endJS", required: false)


